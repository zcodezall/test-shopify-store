<!-- gift-card-balance.liquid -->

{% layout none %}

<!DOCTYPE html>
<html>
<head>
  <title>Gift Card Balance</title>
  <!-- Add any necessary CSS or JavaScript files -->
</head>
<body>
  <h1>Check Gift Card Balance</h1>

  <form id="gift-card-balance-form">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>

    <label for="coupon">Coupon Code:</label>
    <input type="text" id="coupon" name="coupon" required>

    <button type="submit">Check Balance</button>
  </form>

  <div id="balance-result" style="display: none;">
    <p>Your remaining balance: <span id="remaining-balance"></span></p>
  </div>

  <script>
   document.getElementById('gift-card-balance-form').addEventListener('submit', function(event) {
  event.preventDefault();
  const email = document.getElementById('email').value;
  const couponCode = document.getElementById('coupon').value;

  fetch(`/admin/api/2021-09/price_rules.json?code=${encodeURIComponent(couponCode)}`, {
    headers: {
      'X-Shopify-Access-Token': 'YOUR_ACCESS_TOKEN', // Replace with your own access token
    }
  })
    .then(response => response.json())
    .then(data => {
      if (data.errors) {
        // Handle error response
        console.error(data.errors);
      } else {
        // Coupon code is valid, fetch gift card balance
        const priceRuleId = data.price_rules[0].id;
        return fetch(`/admin/api/2021-09/price_rules/${priceRuleId}/gift_cards.json`, {
          headers: {
            'X-Shopify-Access-Token': 'YOUR_ACCESS_TOKEN', // Replace with your own access token
          }
        });
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.errors) {
        // Handle error response
        console.error(data.errors);
      } else {
        // Display remaining balance
        const remainingBalance = data.gift_cards[0].initial_value - data.gift_cards[0].amount_used;
        document.getElementById('remaining-balance').textContent = remainingBalance;
        document.getElementById('balance-result').style.display = 'block';
      }
    })
    .catch(error => {
      // Handle fetch error
      console.error(error);
    });
});

    });
  </script>
</body>
</html>
